<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard do Usuário</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@6.9.96/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css">
    <style>
        .gradient-bg {
            background: linear-gradient(45deg, #3490dc, #6574cd, #9561e2);
            background-size: 200% 200%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG {
            0% {background-position: 0% 50%;}
            50% {background-position: 100% 50%;}
            100% {background-position: 0% 50%;}
        }
        .profile-pic {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .banner {
            height: 200px;
            background-size: cover;
            background-position: center;
        }
        @media (max-width: 640px) {
            .profile-pic {
                width: 100px;
                height: 100px;
            }
            .banner {
                height: 150px;
            }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="flex flex-col md:flex-row min-h-screen">
        <!-- Sidebar -->
        <aside class="w-full md:w-64 bg-gray-800 text-white p-6">
            <h2 class="text-2xl font-bold mb-6">Menu</h2>
            <nav>
                <ul class="space-y-2">
                    <li><a href="#" class="block py-2 px-4 rounded hover:bg-gray-700 transition"><i class="fas fa-tachometer-alt mr-2"></i>Dashboard</a></li>
                    <li><a href="#" class="block py-2 px-4 rounded hover:bg-gray-700 transition"><i class="fas fa-flask mr-2"></i>Laboratório de Código</a></li>
                    <li><a href="#" class="block py-2 px-4 rounded hover:bg-gray-700 transition"><i class="fas fa-project-diagram mr-2"></i>Projetos</a></li>
                    <li><a href="#" class="block py-2 px-4 rounded hover:bg-gray-700 transition"><i class="fas fa-users mr-2"></i>S-Code</a></li>
                    <li><a href="#" class="block py-2 px-4 rounded hover:bg-gray-700 transition"><i class="fas fa-envelope mr-2"></i>Mensagens</a></li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto">
            <div class="gradient-bg banner" id="userBanner">
                <div class="animate-pulse bg-gray-300 h-full w-full"></div>
            </div>
            <div class="container mx-auto px-4 py-8">
                <div class="bg-white rounded-lg shadow-lg p-6 -mt-16 relative z-10">
                    <div class="flex flex-col items-center md:flex-row md:items-start">
                        <div class="md:mr-6 mb-4 md:mb-0">
                            <div class="profile-pic bg-gray-300 animate-pulse" id="userProfilePicContainer">
                                <img src="" alt="Profile Picture" class="profile-pic hidden" id="userProfilePic">
                            </div>
                        </div>
                        <div class="flex-1 text-center md:text-left">
                            <h1 class="text-3xl font-bold mb-2" id="userName">
                                <span class="bg-gray-300 animate-pulse h-8 w-48 inline-block rounded"></span>
                            </h1>
                            <p class="text-gray-600 mb-4" id="userFullName">
                                <span class="bg-gray-300 animate-pulse h-6 w-32 inline-block rounded"></span>
                            </p>
                            <div class="mb-6">
                                <span class="bg-green-500 text-white px-3 py-1 rounded-full text-sm" id="userStatus">Online</span>
                            </div>
                            <p class="text-gray-700 mb-6" id="userBio">
                                <span class="bg-gray-300 animate-pulse h-4 w-full inline-block rounded"></span>
                                <span class="bg-gray-300 animate-pulse h-4 w-3/4 inline-block rounded mt-2"></span>
                            </p>
                            <div class="flex justify-center md:justify-start space-x-4 mb-6" id="socialLinks">
                                <a href="#" class="text-blue-500 hover:text-blue-700 hidden" id="twitterLink"><i class="fab fa-twitter fa-2x"></i><span class="sr-only">Twitter</span></a>
                                <a href="#" class="text-blue-700 hover:text-blue-900 hidden" id="linkedinLink"><i class="fab fa-linkedin fa-2x"></i><span class="sr-only">LinkedIn</span></a>
                                <a href="#" class="text-gray-800 hover:text-black hidden" id="githubLink"><i class="fab fa-github fa-2x"></i><span class="sr-only">GitHub</span></a>
                            </div>
                            <div class="text-center md:text-left">
                                <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition" id="editProfileBtn">
                                    Editar Perfil
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-2xl font-bold mb-4">Estatísticas</h2>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="text-center">
                                <p class="text-4xl font-bold text-blue-500" id="projectCount">-</p>
                                <p class="text-gray-600">Projetos</p>
                            </div>
                            <div class="text-center">
                                <p class="text-4xl font-bold text-green-500" id="contributionCount">-</p>
                                <p class="text-gray-600">Contribuições</p>
                            </div>
                            <div class="text-center">
                                <p class="text-4xl font-bold text-purple-500" id="badgeCount">-</p>
                                <p class="text-gray-600">Badges</p>
                            </div>
                            <div class="text-center">
                                <p class="text-4xl font-bold text-yellow-500" id="rating">-</p>
                                <p class="text-gray-600">Avaliação</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h2 class="text-2xl font-bold mb-4">Atividade Recente</h2>
                        <ul class="space-y-4" id="recentActivity">
                            <li class="flex items-center animate-pulse">
                                <div class="w-6 h-6 rounded-full bg-gray-300 mr-2"></div>
                                <span class="bg-gray-300 h-4 w-3/4 rounded"></span>
                            </li>
                            <li class="flex items-center animate-pulse">
                                <div class="w-6 h-6 rounded-full bg-gray-300 mr-2"></div>
                                <span class="bg-gray-300 h-4 w-3/4 rounded"></span>
                            </li>
                            <li class="flex items-center animate-pulse">
                                <div class="w-6 h-6 rounded-full bg-gray-300 mr-2"></div>
                                <span class="bg-gray-300 h-4 w-3/4 rounded"></span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-md w-full">
            <h2 class="text-2xl font-bold mb-4">Configurações</h2>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="uid">
                    UID
                </label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="uid" type="text" readonly>
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="username">
                    Nome de Usuário
                </label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="username" type="text">
            </div>
            <div class="mb-4">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="fullName">
                    Nome Completo
                </label>
                <input class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="fullName" type="text">
            </div>
            <div class="mb-6">
                <label class="block text-gray-700 text-sm font-bold mb-2" for="theme">
                    Tema
                </label>
                <select class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" id="theme">
                    <option value="light">Claro</option>
                    <option value="dark">Escuro</option>
                </select>
            </div>
            <div class="flex items-center justify-between">
                <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button" id="saveSettingsBtn">
                    Salvar
                </button>
                <button class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline" type="button" id="closeSettingsBtn">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD4FmKe7ei-mcKH4flhnXq9TtwmxfUeq5k",
            authDomain: "b-code-881b2.firebaseapp.com",
            databaseURL: "https://b-code-881b2-default-rtdb.firebaseio.com",
            projectId: "b-code-881b2",
            storageBucket: "b-code-881b2.firebasestorage.app",
            messagingSenderId: "199379425544",
            appId: "1:199379425544:web:2e9ac129c58ca9ee37b4bd",
            measurementId: "G-9FEKL6WX7C"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        let currentUser = null;

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                loadUserData(user.uid);
            } else {
                console.log("No user is signed in.");
                // Redirect to login page or show login prompt
                // window.location.href = 'login.html';
            }
        });

        function loadUserData(uid) {
            const userRef = ref(db, 'users/' + uid);
            onValue(userRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('userName').innerHTML = data.username || 'Nome de Usuário';
                    document.getElementById('userFullName').innerHTML = data.fullName || 'Nome Completo';
                    document.getElementById('userBio').innerHTML = data.bio || 'Bio do usuário...';
                    
                    const profilePic = document.getElementById('userProfilePic');
                    profilePic.src = data.profilePic || 'https://via.placeholder.com/150';
                    profilePic.classList.remove('hidden');
                document.getElementById('userProfilePicContainer').classList.remove('animate-pulse', 'bg-gray-300');
                    
                    document.getElementById('userBanner').style.backgroundImage = `url(${data.banner || 'https://via.placeholder.com/1000x200'})`;
                    document.getElementById('userBanner').innerHTML = '';

                    // Update social links
                    updateSocialLink('twitterLink', data.socialLinks?.twitter);
                    updateSocialLink('linkedinLink', data.socialLinks?.linkedin);
                    updateSocialLink('githubLink', data.socialLinks?.github);

                    // Update statistics
                    document.getElementById('projectCount').textContent = data.statistics?.projects || '0';
                    document.getElementById('contributionCount').textContent = data.statistics?.contributions || '0';
                    document.getElementById('badgeCount').textContent = data.statistics?.badges || '0';
                    document.getElementById('rating').textContent = data.statistics?.rating || '0.0';

                    // Update recent activity
                    updateRecentActivity(data.recentActivity || []);
                }
            });
        }

        function updateSocialLink(elementId, url) {
            const element = document.getElementById(elementId);
            if (url) {
                element.href = url;
                element.classList.remove('hidden');
            } else {
                element.classList.add('hidden');
            }
        }

        function updateRecentActivity(activities) {
            const activityList = document.getElementById('recentActivity');
            activityList.innerHTML = '';
            activities.forEach(activity => {
                const li = document.createElement('li');
                li.className = 'flex items-center';
                li.innerHTML = `
                    <i class="${getActivityIcon(activity.type)} mr-2"></i>
                    <span>${activity.description}</span>
                `;
                activityList.appendChild(li);
            });
        }

        function getActivityIcon(type) {
            switch (type) {
                case 'project': return 'fas fa-code-branch text-blue-500';
                case 'badge': return 'fas fa-trophy text-yellow-500';
                case 'comment': return 'fas fa-comment text-green-500';
                default: return 'fas fa-circle text-gray-500';
            }
        }

        document.getElementById('editProfileBtn').addEventListener('click', () => {
            window.location.href = 'editprofile.html';
        });

        const settingsModal = document.getElementById('settingsModal');
        const openSettingsBtn = document.createElement('button');
        openSettingsBtn.innerHTML = '<i class="fas fa-cog"></i>';
        openSettingsBtn.className = 'fixed bottom-4 right-4 bg-gray-800 text-white p-3 rounded-full shadow-lg hover:bg-gray-700 transition';
        document.body.appendChild(openSettingsBtn);

        openSettingsBtn.addEventListener('click', () => {
            settingsModal.classList.remove('hidden');
            settingsModal.classList.add('flex');
            if (currentUser) {
                document.getElementById('uid').value = currentUser.uid;
                loadUserSettings(currentUser.uid);
            }
        });

        document.getElementById('closeSettingsBtn').addEventListener('click', () => {
            settingsModal.classList.add('hidden');
            settingsModal.classList.remove('flex');
        });

        document.getElementById('saveSettingsBtn').addEventListener('click', () => {
            if (currentUser) {
                const username = document.getElementById('username').value;
                const fullName = document.getElementById('fullName').value;
                const theme = document.getElementById('theme').value;

                const userRef = ref(db, 'users/' + currentUser.uid);
                set(userRef, {
                    username: username,
                    fullName: fullName,
                    theme: theme
                }, { merge: true });

                settingsModal.classList.add('hidden');
                settingsModal.classList.remove('flex');
            }
        });

        function loadUserSettings(uid) {
            const userRef = ref(db, 'users/' + uid);
            onValue(userRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('username').value = data.username || '';
                    document.getElementById('fullName').value = data.fullName || '';
                    document.getElementById('theme').value = data.theme || 'light';
                }
            });
        }

        // Adicione animações e efeitos
        AOS.init();
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
</body>
</html>
