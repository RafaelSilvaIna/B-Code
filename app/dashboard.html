<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B-Code - Perfil do Usuário</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css">
    <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        .sidebar {
            transition: transform 0.3s ease-in-out;
        }
        .sidebar.closed {
            transform: translateX(-100%);
        }
        #background3D {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .profile-frame {
            border: 4px solid;
            border-radius: 50%;
        }
        .frame-1 { border-color: gold; }
        .frame-2 { border-color: silver; }
        .frame-3 { border-color: #cd7f32; }
        .frame-4 { border-color: #e44d26; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="background3D"></div>
    <div class="flex">
        <!-- Sidebar -->
        <div id="sidebar" class="sidebar bg-gray-800 text-white w-64 min-h-screen p-4">
            <button id="toggleSidebar" class="mb-4 bg-blue-500 text-white px-4 py-2 rounded">
                <i class="fas fa-bars"></i> Menu
            </button>
            <nav>
                <ul>
                    <li><a href="#" class="block py-2 hover:bg-gray-700 rounded px-2"><i class="fas fa-users mr-2"></i>Área Social</a></li>
                    <li><a href="#" class="block py-2 hover:bg-gray-700 rounded px-2"><i class="fas fa-flask mr-2"></i>Laboratório</a></li>
                    <li><a href="#" class="block py-2 hover:bg-gray-700 rounded px-2"><i class="fas fa-project-diagram mr-2"></i>Centro De Projetos</a></li>
                    <li><a href="#" class="block py-2 hover:bg-gray-700 rounded px-2"><i class="fas fa-envelope mr-2"></i>Mensagens</a></li>
                    <li><a href="editprofile.html" class="block py-2 hover:bg-gray-700 rounded px-2"><i class="fas fa-user-edit mr-2"></i>Editar Perfil</a></li>
                    <li><a href="#" class="block py-2 hover:bg-gray-700 rounded px-2"><i class="fas fa-cog mr-2"></i>Configuração</a></li>
                </ul>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="flex-1 p-4">
            <div id="profile" class="bg-white rounded-lg shadow-md p-6">
                <!-- Banner -->
                <div id="banner" class="h-48 bg-cover bg-center rounded-t-lg relative">
                    <div id="bannerOverlay" class="absolute inset-0 bg-black opacity-50"></div>
                    <h1 id="fullName" class="absolute bottom-4 left-4 text-4xl font-bold text-white"></h1>
                </div>

                <!-- Profile Info -->
                <div class="flex items-center -mt-12 mb-4 relative z-10">
                    <img id="profilePic" src="" alt="Profile Picture" class="w-24 h-24 rounded-full border-4 border-white profile-frame">
                    <div class="ml-4">
                        <p id="username" class="text-xl font-semibold text-gray-800"></p>
                        <p id="gender" class="text-gray-600"></p>
                        <div id="status" class="text-sm font-medium"></div>
                    </div>
                </div>

                <!-- Biography -->
                <div id="bio" class="mb-6 p-4 border rounded bg-gray-50"></div>

                <!-- Social Links -->
                <div id="socialLinks" class="mb-6 flex flex-wrap gap-2"></div>

                <!-- Projects -->
                <div class="mb-6">
                    <h2 class="text-2xl font-semibold mb-4">Projetos</h2>
                    <div class="swiper-container">
                        <div id="projectsSlider" class="swiper-wrapper"></div>
                        <div class="swiper-pagination"></div>
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div>

                <!-- Contact Info -->
                <div id="contactInfo" class="mb-6"></div>

                <!-- Work Info -->
                <div id="workInfo" class="mb-6"></div>
            </div>
        </div>
    </div>

    <script type="module">
        // Importar Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD4FmKe7ei-mcKH4flhnXq9TtwmxfUeq5k",
            authDomain: "b-code-881b2.firebaseapp.com",
            databaseURL: "https://b-code-881b2-default-rtdb.firebaseio.com",
            projectId: "b-code-881b2",
            storageBucket: "b-code-881b2.firebasestorage.app",
            messagingSenderId: "199379425544",
            appId: "1:199379425544:web:2e9ac129c58ca9ee37b4bd",
            measurementId: "G-9FEKL6WX7C"
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);

        // Função para carregar dados do perfil
        function loadProfileData(userId) {
            const userRef = ref(database, `users/${userId}`);
            onValue(userRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('fullName').textContent = data.fullName;
                    document.getElementById('username').textContent = `@${data.username}`;
                    document.getElementById('gender').textContent = data.gender || 'Não especificado';
                    document.getElementById('bio').innerHTML = data.bio || 'Nenhuma biografia adicionada.';
                    document.getElementById('banner').style.backgroundImage = `url(${data.banner || 'https://via.placeholder.com/1000x250'})`;
                    document.getElementById('profilePic').src = data.profilePic || 'https://via.placeholder.com/150';
                    document.getElementById('profilePic').className = `w-24 h-24 rounded-full border-4 border-white profile-frame frame-${data.frameStyle || '1'}`;
                    
                    // Status
                    const statusEl = document.getElementById('status');
                    statusEl.textContent = data.status || 'Offline';
                    statusEl.className = `text-sm font-medium ${data.status === 'Online' ? 'text-green-500' : 'text-gray-500'}`;

                    // Carregar links sociais
                    const socialLinksContainer = document.getElementById('socialLinks');
                    socialLinksContainer.innerHTML = '';
                    if (data.socialLinks) {
                        for (const [platform, url] of Object.entries(data.socialLinks)) {
                            const link = document.createElement('a');
                            link.href = url;
                            link.target = "_blank";
                            link.className = 'bg-blue-500 text-white px-3 py-1 rounded-full text-sm hover:bg-blue-600 transition duration-300';
                            link.innerHTML = `<i class="fab fa-${platform.toLowerCase()} mr-1"></i>${platform}`;
                            socialLinksContainer.appendChild(link);
                        }
                    }

                    // Carregar projetos
                    const projectsSlider = document.getElementById('projectsSlider');
                    projectsSlider.innerHTML = '';
                    if (data.projects) {
                        data.projects.forEach(project => {
                            const slide = document.createElement('div');
                            slide.className = 'swiper-slide bg-white rounded-lg shadow-md p-4';
                            slide.innerHTML = `
                                <img src="${project.image || 'https://via.placeholder.com/300x200'}" alt="${project.title}" class="w-full h-40 object-cover rounded-t-lg mb-4">
                                <h3 class="text-xl font-semibold mb-2">${project.title}</h3>
                                <p class="text-gray-600 mb-2">${project.subtitle}</p>
                                <p class="text-sm mb-4">${project.description}</p>
                                <a href="${project.link}" target="_blank" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition duration-300">Ver Projeto</a>
                            `;
                            projectsSlider.appendChild(slide);
                        });
                        new Swiper('.swiper-container', {
                            slidesPerView: 1,
                            spaceBetween: 30,
                            navigation: {
                                nextEl: '.swiper-button-next',
                                prevEl: '.swiper-button-prev',
                            },
                            pagination: {
                                el: '.swiper-pagination',
                                clickable: true,
                            },
                            breakpoints: {
                                640: {
                                    slidesPerView: 2,
                                },
                                768: {
                                    slidesPerView: 3,
                                },
                            },
                        });
                    }

                    // Carregar informações de contato
                    const contactInfo = document.getElementById('contactInfo');
                    contactInfo.innerHTML = `
                        <h2 class="text-2xl font-semibold mb-4">Contato</h2>
                        <p><i class="fas fa-envelope mr-2"></i>${data.email}</p>
                        ${data.phone ? `<p><i class="fas fa-phone mr-2"></i>${data.phone}</p>` : ''}
                    `;

                    // Carregar informações de trabalho
                    const workInfo = document.getElementById('workInfo');
                    workInfo.innerHTML = `
                        <h2 class="text-2xl font-semibold mb-4">Experiência Profissional</h2>
                        <p><i class="fas fa-briefcase mr-2"></i>${data.work || 'Nenhuma informação de trabalho adicionada.'}</p>
                    `;

                    // Configurar background 3D
                    if (data.background3D) {
                        setupBackground3D(data.background3D);
                    }
                }
            });
        }

        // Função para configurar o background 3D
        function setupBackground3D(config) {
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('background3D').appendChild(renderer.domElement);

            const geometry = new THREE.TorusKnotGeometry(10, 3, 100, 16);
            const material = new THREE.MeshBasicMaterial({ color: config.color || 0x00ff00, wireframe: true });
            const torusKnot = new THREE.Mesh(geometry, material);
            scene.add(torusKnot);

            camera.position.z = 30;

            function animate() {
                requestAnimationFrame(animate);
                torusKnot.rotation.x += 0.01;
                torusKnot.rotation.y += 0.01;
                renderer.render(scene, camera);
            }
            animate();
        }

        // Verificar o estado de autenticação do usuário
        onAuthStateChanged(auth, (user) => {
            if (user) {
                loadProfileData(user.uid);
            } else {
                // Redirecionar para a página de login se o usuário não estiver autenticado
                window.location.href = 'login.html';
            }
        });

        // Toggle sidebar
        document.getElementById('toggleSidebar').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('closed');
        });

        // Atualizar status online/offline
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        function updateOnlineStatus() {
            const userId = auth.currentUser?.uid;
            if (userId) {
                set(ref(database, `users/${userId}/status`), navigator.onLine ? 'Online' : 'Offline');
            }
        }
    </script>
</body>
</html>
